# Command Helper 功能扩展计划

## 1. 功能概述

本次扩展将为 Command Helper 添加两个核心功能：

### 1.1 命令排行榜
- 记录并展示使用频率最高的命令
- 按使用次数排序
- 显示命令的使用次数
- 支持复制排行榜中的命令

### 1.2 对话模式选择
- 提供两种对话模式：
  - **确定模式**：适合用户比较确定的命令请求
  - **查询模式**：适合用户不确定的命令查询
- 在 API 调用时传递模式参数
- AI 提示词根据模式调整

## 2. 技术实现方案

### 2.1 命令排行榜

#### 2.1.1 后端实现
- 在 `history.json` 中扩展记录格式，添加 `usage_count` 字段
- 创建 `leaderboard.json` 文件存储命令排行榜数据
- 新增 API 端点：
  - `GET /api/leaderboard`：获取排行榜数据
  - `POST /api/leaderboard/increment`：增加命令使用次数

#### 2.1.2 前端实现
- 在主界面添加排行榜区域
- 实现排行榜数据展示和刷新
- 支持复制排行榜中的命令

### 2.2 对话模式选择

#### 2.2.1 后端实现
- 修改 `/api/query` 端点，接收 `mode` 参数
- 根据 `mode` 调整 AI 提示词：
  - **确定模式**：直接返回命令，简洁明确
  - **查询模式**：提供更详细的解释和多种选项

#### 2.2.2 前端实现
- 在输入区域添加模式选择控件（单选按钮或下拉菜单）
- 默认使用 **查询模式**
- 将选择的模式传递给 API

## 3. 详细实现步骤

### 3.1 后端修改

1. **扩展历史记录结构**
   - 修改 `server.js` 中的记录生成逻辑
   - 为每条记录添加 `usage_count` 字段

2. **创建排行榜管理**
   - 实现 `leaderboard.json` 文件的读写
   - 实现命令使用次数的增加和排序

3. **新增 API 端点**
   - `GET /api/leaderboard`：返回排行榜数据
   - `POST /api/leaderboard/increment`：处理命令使用次数增加

4. **修改查询 API**
   - 接收 `mode` 参数
   - 根据模式调整 AI 提示词

### 3.2 前端修改

1. **添加对话模式选择**
   - 在输入区域添加模式选择控件
   - 实现模式状态管理

2. **添加排行榜区域**
   - 在界面底部添加排行榜组件
   - 实现排行榜数据展示
   - 添加复制功能

3. **修改 API 调用**
   - 在查询时传递 `mode` 参数
   - 实现排行榜数据的获取和刷新

### 3.3 网页功能测试

1. 使用 MCP 工具测试前端界面交互
2. 测试不同对话模式下的 API 响应
3. 测试排行榜功能的完整流程
4. 验证数据持久化是否正常

## 4. UI/UX 设计

### 4.1 对话模式选择
- 位置：输入区域下方
- 样式：两个选项卡或单选按钮
- 视觉反馈：当前选中模式高亮显示

### 4.2 命令排行榜
- 位置：历史记录区域下方
- 样式：卡片式设计，按使用次数排序
- 交互：每条记录显示命令、使用次数和复制按钮

## 5. 测试计划

### 5.1 功能测试
- 测试两种对话模式的 API 响应
- 测试命令使用次数的增加
- 测试排行榜数据的准确性
- 测试复制功能

### 5.2 界面测试
- 测试不同屏幕尺寸下的显示效果
- 测试交互流畅性
- 测试加载状态显示

### 5.3 兼容性测试
- 测试主流浏览器兼容性
- 测试不同操作系统下的表现

## 6. 预期效果

1. **命令排行榜**：用户可以查看最常用的命令，快速获取常用解决方案
2. **对话模式选择**：根据需求选择不同的对话模式，获得更个性化的结果
3. **良好的用户体验**：界面简洁美观，交互流畅
4. **数据持久化**：排行榜数据持久保存，重启服务后不丢失

## 7. 依赖说明

无需新增外部依赖，使用现有技术栈即可实现所有功能。

## 8. 实现时间估计

| 功能模块 | 预计时间 |
|---------|---------|
| 后端修改 | 2小时   |
| 前端修改 | 2小时   |
| 测试验证 | 1小时   |
| 总计     | 5小时   |

## 9. 风险评估

1. **AI 响应格式**：需要确保不同模式下 AI 返回格式符合预期
2. **数据一致性**：需要确保历史记录和排行榜数据的一致性
3. **性能问题**：排行榜数据量大时可能影响加载速度，需考虑分页

## 10. 后续优化建议

1. 添加命令分类功能
2. 支持用户自定义命令标签
3. 实现命令收藏功能
4. 添加命令评分和评论功能

以上计划涵盖了功能设计、技术实现、测试验证和后续优化，确保扩展功能的顺利实现和良好的用户体验。